<html xmlns="http://www.w3.org/1999/xhtml"
            xmlns:tal="http://xml.zope.org/namespaces/tal"
            xmlns:metal="http://xml.zope.org/namespaces/metal"
            xmlns:i18n="http://xml.zope.org/namespaces/i18n"
            i18n:domain="plone">

    <head><title></title></head>

    <body>

        <!-- Calendar Widgets -->

        <metal:view_macro define-macro="view"
            tal:define="kssClassesView context/@@kss_field_decorator_view;
                        getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;">
            <div metal:define-macro="calendar-field-view"
                tal:define="kss_class python:getKssClasses(fieldName,
                            templateId='widgets/calendar', macro='calendar-field-view');
                            d accessor;
                            d python:test(d and d=='None','',d);
                            format widget/format;
                            formatted python:format and d and d.strftime(format);
                            tlt nocall:context/toLocalizedTime|nothing;
                            result python:(format and formatted) or (d and tlt and tlt(d, long_format=1)) or None;
                            uid context/UID|nothing;"
                tal:attributes="class kss_class;
                                id string:parent-fieldname-$fieldName-$uid">
                <span metal:define-slot="inside"
                    tal:replace="structure result">calendar</span>
            </div>
        </metal:view_macro>

        <metal:define define-macro="edit"
            tal:define="format widget/format">
            <metal:use use-macro="field_macro | context/widgets/field/macros/edit">
                <metal:fill fill-slot="widget_body">

                    <fieldset class="radiogroup">
                        <legend tal:attributes="class python:'required' if field.required else None">
                            <tal:block tal:replace="python:widget.Label(here)" />

                            <span class="formHelp"
                                tal:define="description python:widget.Description(here)"
                                tal:content="structure description"
                                tal:attributes="id string:${fieldName}_help"
                                i18n:translate="">
                                Help
                            </span>
                        </legend>


                            <tal:define define="id fieldName;
                                                show_hm widget/show_hm|nothing;
                                                show_ymd widget/show_ymd|nothing;
                                                starting_year widget/starting_year|nothing;
                                                ending_year widget/ending_year|nothing;
                                                future_years widget/future_years|nothing;
                                                minute_step widget/minute_step|python:5;
                                                inputname fieldName;
                                                formname string:edit_form;
                                                inputvalue python:test(value!='None', value, '');">
                                <metal:box use-macro="context/widgets/calendar/macros/calendarDatePickerBox|default" />
                            </tal:define>
                    </fieldset>
                </metal:fill>
            </metal:use>
        </metal:define>

        <metal:define define-macro="search">
            <metal:field use-macro="context/widgets/field/macros/edit">
                <metal:slot fill-slot="widget_body">
                    <tal:from define="id fieldName;
                                      show_hm widget/show_hm|nothing;
                                      show_ymd widget/show_ymd|nothing;
                                      minute_step widget/minute_step|python:5;
                                      inputname fieldName;
                                      formname string:search_form;
                                      inputvalue python:min(request.form.get(fieldName, None) or request.other.get(fieldName, None) or ('1975-05-26',)).strip();">
                        <metal:box use-macro="here/calendar_macros/macros/calendarDatePickerBox|default" />
                    </tal:from>
                    <tal:to define="id fieldName;
                                    inputname fieldName;
                                    minute_step widget/minute_step|python:5;
                                    formname string:search_form;
                                    inputvalue python:max(request.form.get(fieldName, None) or request.other.get(fieldName, None) or ('2975-05-26',)).strip();">
                        <metal:box use-macro="here/calendar_macros/macros/calendarDatePickerBox|default" />
                    </tal:to>
                    <input type="hidden"
                        name="field_usage"
                        value="range:min:max"
                        tal:attributes="name string:${fieldName}_usage"
                        />
                </metal:slot>
            </metal:field>
        </metal:define>
        <tal:block
            metal:define-macro="calendarDatePickerBox"
            tal:define="uniqueItemIndex context/@@plone/uniqueItemIndex;
                        inputIndex uniqueItemIndex/next;
                        show_hm show_hm | python:1;
                        show_ymd show_ymd | python:1;
                        starting_year starting_year | nothing;
                        ending_year ending_year | nothing;
                        future_years future_years | nothing;
                        show_single_year show_single_year | python: 1;
                        minute_step minute_step | python: 5;
                        show_jscal show_jscal | python: 1;
                        input_id string:${formname}_${inputname}_${inputIndex};
                        date_components_support_view context/@@date_components_support;
                        values python:date_components_support_view.result(inputvalue, 0, starting_year, ending_year, future_years, minute_step);
                        years values/years;
                        months values/months;
                        days values/days;
                        hours values/hours;
                        minutes values/minutes;
                        ampm values/ampm;
                        yearStart python:years[0]['value'];
                        yearEnd python:years[-1]['value'];">

            <ul class="plone_jscalendar" role="group">
                <input type="hidden" tal:attributes="name string:$inputname;
                                                     id input_id;
                                                     value python:not show_hm and inputvalue and hasattr(inputvalue, 'strftime') and inputvalue.strftime('%Y/%m/%d') or inputvalue"/>
                <input type="hidden" tal:attributes="id inputname;" />

                <tal:ymd condition="not:show_ymd">
                    <input type="hidden"
                        id="ic_year"
                        value="1900"
                        tal:attributes="id string:${input_id}_year;"/>
                    <input type="hidden"
                        id="ic_month"
                        value="1"
                        tal:attributes="id string:${input_id}_month;"/>
                    <input type="hidden"
                        id="ic_day"
                        value="1"
                        tal:attributes="id string:${input_id}_day;"/>
                </tal:ymd>

                <tal:ymd condition="show_ymd">
                    <li>
                        <label class="hiddenStructure"
                            i18n:translate=""
                            tal:attributes="for string:${input_id}_year">
                            Year
                        </label>
                        <select size="1" aria-label="Year"
                            tal:attributes="name string:${inputname}_year;
                                            id string:${input_id}_year;
                                            onfocus onfocus|nothing;
                                            onblur onblur|nothing;
                                            readonly python:'readonly' if len(years)==1 else None"
                            tal:condition="python:len(years)!=1">
                            <option
                                tal:repeat="year years"
                                tal:attributes="value year/value;
                                                selected year/selected"
                                tal:content="year/id" />
                        </select>
                    </li>

                    <li>
                        <label class="hiddenStructure"
                            i18n:translate=""
                            tal:attributes="for string:${input_id}_month">
                            Month
                        </label>
                        <select size="1" aria-label="Month"
                            tal:attributes="name string:${inputname}_month;
                                id string:${input_id}_month;
                                onfocus onfocus|nothing;
                                onblur onblur|nothing;">
                            <option
                                tal:repeat="month months"
                                tal:attributes="value month/value; selected month/selected"
                                tal:content="month/title" />
                        </select>
                    </li>

                    <li>
                        <label
                            i18n:translate=""
                            tal:attributes="for string:${input_id}_day">
                            Day
                        </label>
                        <select size="1" aria-label="Month"
                            tal:attributes="name string:${inputname}_day;
                                            id string:${input_id}_day;
                                            onfocus onfocus|nothing;
                                            onblur onblur|nothing;">

                            <option
                                tal:repeat="day days"
                                tal:attributes="value day/value;
                                                selected day/selected"
                                tal:content="day/id" />
                        </select>

                        <span tal:condition="show_jscal"
                            class="plone-jscalendar-popup"
                            style="display:none"
                            tal:attributes="id string:${input_id}_popup;">
                            <input type="hidden"
                                tal:attributes="name string:${inputname}_yearStart;
                                                id string:${input_id}_yearStart;
                                                value yearStart" />
                            <input type="hidden"
                                tal:attributes="name string:${inputname}_yearEnd;
                                                id string:${input_id}_yearEnd;
                                                value yearEnd" />
                            <img alt="" src="" tal:replace="structure context/popup_calendar.png" />
                        </span>
                    </li>
                </tal:ymd>

                <li tal:condition="show_hm">
                    <label
                        i18n:translate=""
                        tal:attributes="for string:${input_id}_hour">
                        Hour
                    </label>
                    <select size="1" aria-label="Hour"
                        tal:attributes="name string:${inputname}_hour;
                                        id string:${input_id}_hour;
                                        onfocus onfocus|nothing;
                                        onblur onblur|nothing;">
                        <option
                            tal:repeat="hour hours"
                            tal:attributes="value hour/value;
                                            selected hour/selected"
                            tal:content="hour/id" />
                    </select>
                </li>

                <tal:block tal:condition="not: show_hm">
                    <input type="hidden" value="00"
                        tal:attributes="name string:${inputname}_hour;
                                        id string:${input_id}_hour;" />
                </tal:block>

                <li tal:condition="show_hm">
                    <label
                        tal:attributes="for string:${input_id}_minute"
                        i18n:translate="">
                        Minute
                    </label>
                    <select size="1" aria-label="Minute"
                        tal:attributes="name string:${inputname}_minute;
                                        id string:${input_id}_minute;
                                        onfocus onfocus|nothing;
                                        onblur onblur|nothing;">
                        <option
                            tal:repeat="minute minutes"
                            tal:attributes="value minute/value;
                                            selected minute/selected"
                            tal:content="minute/id">hour</option>
                     </select>
                </li>

                <tal:block tal:condition="not: show_hm">
                    <input type="hidden" value="00"
                        tal:attributes="name string:${inputname}_minute;
                                        id string:${input_id}_minute;"/>
                </tal:block>

                <li tal:condition="python: ampm and show_hm">
                    <label
                        i18n:translate=""
                        tal:attributes="for string:${input_id}_ampm">
                        AM/PM
                    </label>
                    <select size="1" aria-label="am or pm"
                        tal:attributes="name string:${inputname}_ampm;
                                        id string:${input_id}_ampm;
                                        onfocus onfocus|nothing;
                                        onblur onblur|nothing;">
                        <option
                            tal:repeat="ampm ampm"
                            tal:attributes="value ampm/value;
                                            selected ampm/selected"
                            i18n:translate=""
                            tal:content="ampm/id" />
                    </select>
                </li>

                <tal:block tal:condition="python:not ampm or not show_hm">
                    <input name="ic_ampm"
                        type="hidden"
                        id="ic_ampm"
                        size="1"
                        tal:attributes="name string:${inputname}_ampm;
                                        id string:${input_id}_ampm;
                                        value python:''"
                        />
                </tal:block>
            </ul>
        </tal:block>
    </body>
</html>
